<!DOCTYPE html>
<html>
<link rel=stylesheet type=text/css href="{{ url_for('static', filename='style.css') }}">
<head>
  <title>Deputados mais tops do Brasil</title>
</head>
<body>
  <div class="container">
    <div>
      <h1>PESQUISAR POR</h1>
    </div>
    {% if dados %}
      <div id="name" >
        <div class="select-style">
          <select name="cargo">
            <option value="Deputados">Deputados</option>
            <option value="Partidos">Partidos</option>
          </select>
        </div>
        <label for="s-option">DIGITE</label>
        <input value="{{ request['pesquisa'] }}" type="" name="name">
        <button id="search">pesquisar</button>
      </div>

      <div id="type" style="display: none">
        <ul>
            {% if dados[0].siglaPartido %}
            <li>  
              <input type="radio" id="f-option" name="selector" value="deputados" checked="checked">
              <label for="f-option">Deputados</label>
              <div class="check"></div>
            </li>
            <li>
              <input type="radio" id="s-option" name="selector" value="partidos">
              <label for="s-option">Partidos</label>
              <div class="check"><div class="inside"></div></div>
            </li>
            {% else %}
            <li>  
              <input type="radio" id="f-option" name="selector" value="deputados">
              <label for="f-option">Deputados</label>
              <div class="check"></div>
            </li>
            <li>
              <input type="radio" id="s-option" name="selector" value="partidos" checked="checked">
              <label for="s-option">Partidos</label>
              <div class="check"><div class="inside"></div></div>
            </li>
            {% endif %}
        </ul>
      </div>
    {% else %}
      <div id="type">
        <ul>
          <li>
            <input type="radio" id="f-option" name="selector" value="deputados">
            <label for="f-option">Deputados</label>
            <div class="check"></div>
          </li>
          <li>
            <input type="radio" id="s-option" name="selector" value="partidos">
            <label for="s-option">Partidos</label>
            <div class="check"><div class="inside"></div></div>
          </li>
        </ul>
      </div>
      
      <div id="name" style="display: none">
        <div class="select-style">
          <select name="cargo">
            <option value="Deputados">Deputados</option>
            <option value="Partidos">Partidos</option>
          </select>
        </div>
        <input type="" name="name">
        <label for="s-option">DIGITE</label>
        <button id="search">pesquisar</button>
      </div>
    {% endif %}
    
    <div id="results">  
      {% for dado in dados %}
       <div>
         {% if dado.siglaPartido%}
          <a href="/deputado/{{dado.id}}">
            <div class="avatar"><img src="{{dado.urlFoto}}"></div>        
            <div class="name">{{dado.nome}}</div>
          </a>
        {% else %}
          <a href="/partido/{{dado.id}}">        
            <div class="name">{{dado.sigla}}</div>
          </a>
        {% endif %}
      </div>
      {% endfor %}

    </div>
    {% include "loader.html" %}
  </div>


  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script type="text/javascript">
    function deleteResultsChilds ()
    {
        var result = document.getElementById('results');

        while(result.firstChild){
            result.removeChild(result.firstChild);
        }
    }

    //trata as alterações feitas no Radio e passa para o select
    $('input[type="radio"]').on('change', function(){
      if(!this.value){
      } else {
        if($('input[type="radio"]:checked').val() == "deputados")
        {
          $('select[name="cargo"]').val('Deputados');
        }
        else{
          $('select[name="cargo"]').val('Partidos');
        }
        $('#type').hide()
        $('#name').show()
      }
    })

    //trata as alterações feitas no select e passa para o radio
    $('select[name="cargo"]').on('change', function(){
      if(!this.value){
      } else {
        if($('select[name="cargo"]').val() == "Deputados")
        {
          $('#s-option').prop('checked', false);
          $('#f-option').prop('checked', true);
        }
        else{
          $('#f-option').prop('checked', false);
          $('#s-option').prop('checked', true);
        }
        $('#type').hide()
        $('#name').show()
      }
    })
    
    $('#search').on('click', function(){
      $('#search').prop('disabled', true);
      var route = $('input[type="radio"]:checked').val();
      var name = $('input[name="name"]').val();

      $.ajax({
        method: "GET",
        url: '/',
        data: {[route]: name},
        beforeSend: function(){
          deleteResultsChilds();
          $("#loader-gif").show()
        },
        success: function(res){
          res.map((e, k) => {
            return (
              $(
                `
                <a href="/deputado/${e.id}">
                <div class="avatar"><img src="${e.urlFoto}"></div>        
                <div class="name">${e.nome}</div>
                </a>
                `
              ).appendTo('#results')
            )
          })
        },
        complete: function(){
          $("#loader-gif").hide()
          $('#search').prop('disabled', false);
        }
      })
    })
  </script>
</body>
</html>